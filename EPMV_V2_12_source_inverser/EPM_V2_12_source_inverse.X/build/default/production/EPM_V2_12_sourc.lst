MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 
                      00002 
Warning[205]: Found directive in column 1. (include)
                      00003 include <p12F683.inc>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : May 28 2014
                      00005 ;  MPASM PIC12F683 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2014 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00460         LIST
2007   33DC           00004      __config (_INTRC_OSC_NOCLKOUT & _WDT_ON & _PWRTE_OFF & _MCLRE_OFF & _CP_OFF & _IESO_OFF & _FCMEN_OF
                            F)
                      00005 
                      00006 
                      00007 
                      00008 ;runs on PIC12F683
                      00009 ;Andreas Jochum
                      00010 
                      00011 
                      00012 ;GPIOs
                      00013 ;GPIO,0 Output, Data, high=on, low=off, output to pin 4 on JP2, ICSP
                      00014 ;GPIO,1 Output, Charge enable, ICSP pin 5 on JP2
                      00015 ;GPIO,2 Input Button, Output, LED
                      00016 ;GPIO,3 Input, PWM
                      00017 ;GPIO,4 Output, Thyristor out for on
                      00018 ;GPIO,5 Output, Thyristor out for off
                      00019 
                      00020 
                      00021 
                      00022 ;Interrupt_Call
                      00023 ;Button                         ->go to Button
                      00024 ;Timer_overflow         ->go to NO_PWM
                      00025 ;PWM                            ->go to PWM
                      00026 
                      00027 
                      00028 
                      00029 
                      00030 
                      00031 
                      00032 
                      00033 
                      00034 
                      00035         cblock 0x20                             ; Variables starting at this address
  00000020            00036         Delay:2                                 ; Define two registers for the Delay and Delay + 1
  00000022            00037         Off_Pulse_Lengh
  00000023            00038         On_Pulse_Lengh
  00000024            00039         Center_Pulse_Lengh
  00000025            00040         GPIO_Last
  00000026            00041         GPIO_Current                    ;needed to find out if we had a a trigger on rising or falling e
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            dge
  00000027            00042         Status1                                 ;100 =undefined 10=on 1=off
  00000028            00043         PWM_Lengh
  00000029            00044         PWM_timout_counter_rollover
                      00045 
                      00046 
  0000002A            00047         PWM_Counter
  0000002B            00048         PWM_Last
  0000002C            00049         PWM_current
                      00050 
                      00051          endc
                      00052 
                      00053      org 0                ; Start at flash address 0
0000                  00054 Start:
0000   2???           00055         goto Setup
0001   0000           00056         nop
0002   0000           00057         nop
0003   0000           00058         nop
0004   2???           00059         goto Interrupt_Call
                      00060 
                      00061 
0005                  00062 Setup:
                      00063 
0005   1683           00064         Banksel OSCCON
0006   3070           00065     movlw       0x70
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0007   008F           00066         movwf   OSCCON                  ; Set the internal clock speed to 8 Mhz
0008   3007           00067         movlw   0x07
0009   1283           00068         Banksel CMCON0
000A   0099           00069     movwf       CMCON0                  ; Turn off Comparator (GP0, GP1, GP2)
000B   1683           00070         Banksel ANSEL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000C   019F           00071         clrf    ANSEL                   ; Make all ports as digital I/O
                      00072 
                      00073 
                      00074 
000D   1283           00075         Banksel WDTCON
000E   1498           00076         BsF WDTCON,WDTPS0               ;Watchdog Timer Period Select bits
000F   1118           00077         BcF WDTCON,WDTPS1               ;1010= 1:32768
0010   1198           00078         BcF WDTCON,WDTPS2               ;1024ms
0011   1618           00079         BsF WDTCON,WDTPS3
0012   1418           00080         BSF WDTCON,SWDTEN
0013   1498           00081         BSF WDTCON,WDTPS0               ;Software Enable or Disable the Watchdog Timer (turn off for now
                            )
                      00082 
0014   1683           00083         Banksel OPTION_REG
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0015   1781           00084         BSF     OPTION_REG,7            ;GPIO Pull-up Enable bit
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0016   1701           00085         BSF     OPTION_REG,INTEDG       ;Interrupt Edge Select bit
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0017   1281           00086         BCF OPTION_REG,T0CS             ;Timer0 Clock Source Select bit
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0018   1201           00087         BCF OPTION_REG,T0SE             ;Timer0 Source Edge Select bit (irelevant)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0019   1181           00088         BCF OPTION_REG,PSA              ;Prescaler Assignment bit  (Assinged to Timer0)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001A   1401           00089         BSF     OPTION_REG,PS0          ;Prescaler Rate Select bits
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001B   1481           00090         BSF OPTION_REG,PS1              ;111 = 1:256, 32ms
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001C   1501           00091         BSF     OPTION_REG,PS2          ;
                      00092 
001D   1683           00093         Banksel WPU
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001E   1115           00094         BCF     WPU,2                   ;disable weak pull up on gpio 2 (button)
                      00095 
                      00096 
001F   1683           00097         Banksel TRISIO
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0020   1005           00098         BCF             TRISIO,0                ;GPIO,0 output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0021   1085           00099         BCF             TRISIO,1                ;GPIO,1 output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0022   1505           00100         BSF             TRISIO,2                ;GPIO,2 input
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0023   1585           00101         BSF             TRISIO,3                ;GPIO,3 input
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0024   1205           00102         BCF             TRISIO,4                ;GPIO,4 output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0025   1285           00103         BCF             TRISIO,5                ;GPIO,5 output
                      00104 
                      00105 
                      00106 
                      00107 
0026   1283           00108         Banksel INTCON
0027   178B           00109         BSF             INTCON,GIE              ;Global Interrupt Enable bit
0028   130B           00110         BCF             INTCON,PEIE             ;Peripheral Interrupt Enable bit
0029   168B           00111         BSF             INTCON,T0IE             ;Timer0 Overflow Interrupt Enable bit
002A   160B           00112         BSF             INTCON,INTE             ;GP2/INT External Interrupt Enable bit
002B   158B           00113         BSF             INTCON,GPIE             ;GPIO Change Interrupt Enable bit
                      00114 
002C   1683           00115         Banksel IOC                             ;interupt on change
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002D   1016           00116         BCF             IOC,0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002E   1096           00117         BCF             IOC,1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002F   1116           00118         BCF             IOC,2                   ;input button, don't need to enable on change
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0030   1596           00119         BSF             IOC,3                   ;input PWM
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0031   1216           00120         BCF             IOC,4
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0032   1296           00121         BCF             IOC,5
                      00122 
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00123         ;Turn watchdog on
0033   0064           00124         CLRWDT                                  ;clear the WDT just in case
0034   1283           00125         Banksel WDTCON
0035   1498           00126         BSF WDTCON,WDTPS0               ;Software Enable or Disable the Watchdog Timer (on)
0036   0064           00127         CLRWDT                                  ;clear the WDT just in case
                      00128 
                      00129         ;Turn thyristors charger off
0037   1283           00130         Banksel GPIO
0038   1085           00131         BCF             GPIO,1                  ;charge disable GPIO,0
                      00132 
0039   1205           00133         BCF     GPIO,4                  ;thyristor output low
003A   1285           00134         BCF     GPIO,5                  ;thyristor output low
                      00135 
                      00136         ;Define PWM Pulse width
003B   1283           00137         Banksel Off_Pulse_Lengh
003C   300A           00138         movlw   .010            ;0x0A=08, or 1.25ms
003D   00A2           00139         movwf   Off_Pulse_Lengh
                      00140 
003E   1283           00141         Banksel On_Pulse_Lengh
003F   300E           00142         movlw   .014                    ;0x0E=12, or 1.75ms
0040   00A3           00143         movwf   On_Pulse_Lengh
                      00144 
0041   1283           00145         Banksel Center_Pulse_Lengh
0042   300A           00146         movlw   .010                            ;0x0C=10, or 1.5ms
0043   00A4           00147         movwf   Center_Pulse_Lengh
                      00148 
                      00149         ;Define how many times a PWM is missed before blinking LED once
0044   301E           00150         movlw   .030
0045   00A9           00151         movwf   PWM_timout_counter_rollover
                      00152 
                      00153 
                      00154         ;Counters usded to see how many consecutive on or off pulses we had
                      00155 
0046   3002           00156         movlw   .002
0047   00AA           00157         movwf   PWM_Counter
                      00158 
                      00159 
0048   3000           00160         movlw   0x0
0049   00AB           00161         movwf   PWM_Last
                      00162 
004A   3000           00163         movlw   0x0
004B   00AC           00164         movwf   PWM_current
                      00165 
                      00166         ;Set current status
004C   1283           00167         Banksel Status1
004D   3004           00168         movlw   B'00000100'     ;init status variable, 100 =undefined 010=on 001=off
004E   00A7           00169         movwf   Status1
                      00170 
                      00171         ;wait before turning charger on, make sure the thyristors are off
004F   3001           00172         movlw   .001                                    ;Wait 1 ms delay,
0050   2???           00173         call    DelayMs
                      00174         ;turn charger on
0051   1283           00175         Banksel GPIO
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0052   1485           00176         BSF             GPIO,1                  ;charge enable is on GPIO,1
0053   1005           00177         BCF     GPIO,0                  ;data low
                      00178 
                      00179 
                      00180         ;if we get a reset togle data pin twice
                      00181 
                      00182 ;       BSF     GPIO,0
                      00183 ;       BCF GPIO,0
                      00184 ;       BSF     GPIO,0
                      00185 ;       BCF GPIO,0
                      00186 
                      00187 
0054   2???           00188         goto Main_Loop
                      00189 
0055                  00190 Main_Loop:
                      00191 ;we should be here at least once per second so reset the WDT
Warning[203]: Found opcode in column 1. (CLRWDT)
0055   0064           00192 CLRWDT
                      00193 
Warning[203]: Found opcode in column 1. (goto)
0056   2???           00194 goto Main_Loop
                      00195 
                      00196 
0057                  00197 Interrupt_Call:
                      00198 
0057   1283           00199                 Banksel INTCON
                      00200         ;       BCF INTCON,GIE                                  ;disable all interups
                      00201                 ;save the GPIO, needed to detect rision or falling edge
0058   1283           00202                 Banksel GPIO
0059   0826           00203                 movf GPIO_Current,0
005A   1283           00204                 Banksel GPIO_Last
005B   00A5           00205                 movwf GPIO_Last                                 ;save current value as last
005C   1283           00206                 Banksel GPIO
005D   0805           00207                 movf GPIO,0                                             ;copy GPIO into GPIO_current
005E   1283           00208                 Banksel GPIO_Current
005F   00A6           00209                 movwf GPIO_Current
                      00210 
                      00211                 ;check where the interrupt came from
0060   1283           00212                 Banksel INTCON
                      00213 
0061   190B           00214                 BTFSC   INTCON,T0IF
0062   2???           00215                 goto    Timer                                           ;if TOIF bit is set interrupt ca
                            me from the timer
                      00216                                                                                         ;Timer rolled ov
                            er, call no pwm alert time: 32ms
                      00217 
0063   188B           00218                 BTFSC INTCON,INTF
0064   2???           00219                 goto    Button                                          ;interrupt came from GPIO2
                      00220 
                      00221 
                      00222 
0065   180B           00223                 BTFSC   INTCON,GPIF                             ;if the interrupt came from other GPIO
0066   2???           00224                 goto    PWM                                             ;asume its GPIO3 PWM
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00225 
                      00226 
                      00227                 ;if we ended up here something whent wrong clear the interrupt
0067   2???           00228                 goto Return_From_Interrupt
                      00229 
0068                  00230 Timer
                      00231 
0068   0BA9           00232                 DECFSZ PWM_timout_counter_rollover,1
0069   2???           00233                         goto blah
006A   2???           00234                 call PWM_warning                                        ;Blink LED
006B                  00235 blah
006B   1283           00236                 Banksel TMR0
006C   0181           00237                 Clrf    TMR0                                    ;reset the time0
006D   2???           00238                 goto Return_From_Interrupt
                      00239 
006E                  00240 Button
006E   1283           00241                 Banksel INTCON
006F   100B           00242                 BCF INTCON,GPIF
                      00243 
                      00244 
0070   1283           00245                 BANKSEL INTCON
0071   120B           00246                 BCF INTCON,INTE                                         ;cleare gp2 external intrrupt fl
                            ag
0072   1283           00247                 Banksel Status1
                      00248 
                      00249                                                                                         ;Status is not o
                            ff
0073   18A7           00250                 BTFSC   Status1,1
0074   2???           00251                 goto Turn_Off                                           ;Status is on, so Turn_Off
                      00252 
                      00253 
                      00254                 ;Status is not off turn on
0075   2???           00255                 goto Turn_On
                      00256 
0076   2???           00257                 goto Return_From_Interrupt
0077                  00258 PWM
                      00259 
0077   1DA6           00260                 BTFSS   GPIO_Current,GP3        ;
0078   2???           00261                 goto Falling_Edge                       ;we got the falling edge
0079   19A6           00262                 BTFSC   GPIO_Current,GP3
007A   2???           00263                 goto Rising_Edge                        ;we got a rising edge
007B   1283           00264                 Banksel GPIO
                      00265 
007C                  00266 Rising_Edge:
007C   1283           00267                 Banksel TMR0
007D   0181           00268                 Clrf    TMR0                                    ;reset the time0
                      00269 
007E   2???           00270                 goto Return_From_Interrupt
                      00271 
                      00272 
                      00273 
007F                  00274 Falling_Edge:
007F   1283           00275                 Banksel TMR0
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0080   0801           00276                 movf TMR0,0             ;move timer counter into w
                      00277 
0081   1283           00278                 Banksel PWM_Lengh
0082   00A8           00279                 movwf PWM_Lengh         ;
                      00280 
                      00281 
                      00282 
0083                  00283 normo:
                      00284                 ;test if PWM is greater then 0.75 and smaller then 2.25ms,
0083   3005           00285                 movlw .005                      ; 0.75 ms
0084   0228           00286                 SUBWF PWM_Lengh,0
0085   1283           00287                 Banksel STATUS
0086   1C03           00288                 BTFSS STATUS,C          ;
0087   2???           00289                 goto Invalid_PWM
                      00290 
0088   3011           00291                 movlw .017                      ; 2.25 ms,
0089   0228           00292                 SUBWF PWM_Lengh,0
008A   1283           00293                 Banksel STATUS
008B   1803           00294                 BTFSC STATUS,C          ;
008C   2???           00295                 goto Invalid_PWM
                      00296 
                      00297 
008D   0822           00298                 movf Off_Pulse_Lengh,0                  ; 1.25 ms
008E   0228           00299                 SUBWF PWM_Lengh,0
008F   1283           00300                 Banksel STATUS
0090   1C03           00301                 BTFSS STATUS,C          ;
0091   2???           00302                 goto Off_Pulse
                      00303 
0092   0823           00304                 movf On_Pulse_Lengh,0                   ; 1.75ms
0093   0228           00305                 SUBWF PWM_Lengh,0
0094   1283           00306                 Banksel STATUS
0095   1803           00307                 BTFSC STATUS,C          ;
0096   2???           00308                 goto On_Pulse
                      00309 
0097   3002           00310                 movlw   .002
0098   00AA           00311                 movwf   PWM_Counter
0099   2???           00312                 goto Return_From_Interrupt
                      00313 
                      00314 
009A                  00315 On_Pulse
                      00316 
009A   1C2B           00317                 BTFSS PWM_Last,0
009B   2???           00318                         goto Reset_PWM_Counter_On                                       ;last was not on
                      00319 
                      00320 
Message[305]: Using default destination of 1 (file).
009C   0BAA           00321                 DECFSZ PWM_Counter
009D   2???           00322                         goto Return_From_Interrupt                                                      
                            ;hadnenough singals
009E   2???           00323                 goto Turn_On
                      00324 
009F                  00325 Off_Pulse
009F   182B           00326                 BTFSC PWM_Last,0
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A0   2???           00327                         goto Reset_PWM_Counter_Off                                      ;last was not on
                      00328 
                      00329 
Message[305]: Using default destination of 1 (file).
00A1   0BAA           00330                 DECFSZ PWM_Counter
00A2   2???           00331                         goto Return_From_Interrupt                                                      
                                    ;had enough singals
00A3   2???           00332                 goto Turn_Off
                      00333 
                      00334 
                      00335 
00A4                  00336 Reset_PWM_Counter_On
00A4   3002           00337                 movlw   .002
00A5   00AA           00338                 movwf   PWM_Counter
00A6   3001           00339                 movlw   .001                            ;pwm last was on
00A7   00AB           00340                 movwf   PWM_Last
00A8   2???           00341                 goto Return_From_Interrupt
                      00342 
                      00343 
00A9                  00344 Reset_PWM_Counter_Off
00A9   3002           00345                 movlw   .002
00AA   00AA           00346                 movwf   PWM_Counter
00AB   3000           00347                 movlw   .000                            ;pwm last was off
00AC   00AB           00348                 movwf   PWM_Last
00AD   2???           00349                 goto Return_From_Interrupt
                      00350 
                      00351 
                      00352 
                      00353 
00AE   0BA8           00354 test    DECFSZ PWM_Lengh,1
00AF   2???           00355                         goto debug
00B0   2???           00356                 goto Return_From_Interrupt
00B1   1405           00357 debug:  BSF             GPIO,0
00B2   0000           00358                 nop
00B3   0000           00359                 nop
00B4   1005           00360                 BCF             GPIO,0
00B5   2???           00361                 goto test
                      00362 
                      00363 
                      00364 
00B6                  00365 Invalid_PWM
00B6   3002           00366                 movlw   .002
00B7   00AA           00367                 movwf   PWM_Counter
00B8   2???           00368                 goto Return_From_Interrupt
                      00369 
00B9                  00370 Turn_On
00B9   3002           00371         movlw   .002
00BA   00AA           00372         movwf   PWM_Counter
                      00373         ;disable capacitor charger, GPIO1
00BB   1283           00374         Banksel GPIO
00BC   1085           00375         bcf             GPIO,1
                      00376 ;       movlw   .050                            ; needs testing if it can be reduced to 20ms
00BD   2???           00377         call    DelayMs                         ; Call DelayMs Subroutine
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00378 
                      00379         ;set Status to On 010
00BE   1283           00380         Banksel Status1
00BF   1027           00381         BCF Status1,0
00C0   14A7           00382         BSF Status1,1
00C1   1127           00383         BCF Status1,2
                      00384 
                      00385         ;Pull data high
00C2   1283           00386         Banksel GPIO
00C3   1405           00387         BSF     GPIO,0
                      00388 
                      00389 
                      00390         ;set GPIO4 high for 1mS
00C4   1283           00391         Banksel GPIO
00C5   1605           00392         bsf             GPIO,4
00C6   3005           00393         movlw   .005                            ; 1 ms delay
00C7   2???           00394         call    DelayMs                         ; Call DelayMs Subroutine
00C8   1283           00395         Banksel GPIO
00C9   1205           00396         bcf             GPIO,4
                      00397 
                      00398 
                      00399         ;wait till switch cycle is complete
                      00400 ;       movlw   .050                            ; needs testing if it can be reduced to 20ms
00CA   2???           00401         call    DelayMs                         ; Call DelayMs Subroutine
                      00402 
                      00403 
                      00404         ;turn capacitor charger back on
00CB   1283           00405         Banksel GPIO
00CC   1485           00406         bsf             GPIO,1
                      00407 
00CD   0064           00408         CLRWDT                                                  ;just in case
                      00409                                                                         ;blink the LED 6 times, waiting 
                            ~600ms enough to charge the capacitor (charging takes longer at <5V inpu)
00CE   2???           00410         call Blink_LED
00CF   3064           00411         movlw   .100                                    ;Wait 100 ms delay,
00D0   2???           00412         call    DelayMs
00D1   2???           00413         call Blink_LED
00D2   3064           00414         movlw   .100                                    ;Wait 100 ms delay,
00D3   2???           00415         call    DelayMs
00D4   2???           00416         call Blink_LED
00D5   3064           00417         movlw   .100                                    ;Wait 100 ms delay,
00D6   0064           00418         CLRWDT                                                  ;clear the WDT just in case
00D7   2???           00419         call    DelayMs
00D8   2???           00420         call Blink_LED
00D9   3064           00421         movlw   .100                                    ;Wait 100 ms delay,
00DA   2???           00422         call    DelayMs
00DB   2???           00423         call Blink_LED
00DC   3064           00424         movlw   .100                                    ;Wait 100 ms delay,
00DD   2???           00425         call    DelayMs
00DE   2???           00426         call Blink_LED
00DF   30C8           00427         movlw   .200                                    ;Wait 100 ms delay,
00E0   2???           00428         call    DelayMs
00E1   30C8           00429         movlw   .200                                    ;Wait 100 ms delay,
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00E2   0064           00430         CLRWDT                                                  ;clear the WDT just in case
                      00431 ;2
                      00432 
00E3   3002           00433         movlw   .002
00E4   00AA           00434         movwf   PWM_Counter
                      00435         ;disable capacitor charger, GPIO1
00E5   1283           00436         Banksel GPIO
00E6   1085           00437         bcf             GPIO,1
                      00438 ;       movlw   .050                            ; needs testing if it can be reduced to 20ms
00E7   2???           00439         call    DelayMs                         ; Call DelayMs Subroutine
                      00440 
                      00441         ;set Status to On 010
00E8   1283           00442         Banksel Status1
00E9   1027           00443         BCF Status1,0
00EA   14A7           00444         BSF Status1,1
00EB   1127           00445         BCF Status1,2
                      00446 
                      00447         ;Pull data high
00EC   1283           00448         Banksel GPIO
00ED   1405           00449         BSF     GPIO,0
                      00450 
                      00451 
                      00452         ;set GPIO4 high for 1mS
00EE   1283           00453         Banksel GPIO
00EF   1605           00454         bsf             GPIO,4
00F0   3005           00455         movlw   .005                            ; 1 ms delay
00F1   2???           00456         call    DelayMs                         ; Call DelayMs Subroutine
00F2   1283           00457         Banksel GPIO
00F3   1205           00458         bcf             GPIO,4
                      00459 
                      00460 
                      00461         ;wait till switch cycle is complete
                      00462 ;       movlw   .050                            ; needs testing if it can be reduced to 20ms
00F4   2???           00463         call    DelayMs                         ; Call DelayMs Subroutine
                      00464 
                      00465 
                      00466         ;turn capacitor charger back on
00F5   1283           00467         Banksel GPIO
00F6   1485           00468         bsf             GPIO,1
00F7   0064           00469         CLRWDT                                                  ;just in case
                      00470                                                                         ;blink the LED 6 times, waiting 
                            ~600ms enough to charge the capacitor (charging takes longer at <5V inpu)
00F8   2???           00471         call Blink_LED
00F9   3064           00472         movlw   .100                                    ;Wait 100 ms delay,
00FA   2???           00473         call    DelayMs
00FB   2???           00474         call Blink_LED
00FC   3064           00475         movlw   .100                                    ;Wait 100 ms delay,
00FD   2???           00476         call    DelayMs
00FE   2???           00477         call Blink_LED
00FF   3064           00478         movlw   .100                                    ;Wait 100 ms delay,
0100   0064           00479         CLRWDT                                                  ;clear the WDT just in case
0101   2???           00480         call    DelayMs
0102   2???           00481         call Blink_LED
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0103   3064           00482         movlw   .100                                    ;Wait 100 ms delay,
0104   2???           00483         call    DelayMs
0105   2???           00484         call Blink_LED
0106   3064           00485         movlw   .100                                    ;Wait 100 ms delay,
0107   2???           00486         call    DelayMs
0108   2???           00487         call Blink_LED
                      00488 
0109   2???           00489         call    DelayMs
010A   1283           00490         Banksel TMR0
010B   0181           00491         Clrf    TMR0                                    ;reset the time0\
                      00492 
                      00493 ;3
                      00494 
010C   2???           00495                 goto Return_From_Interrupt
                      00496 
010D                  00497 Turn_Off
010D   3002           00498         movlw   .002
010E   00AA           00499         movwf   PWM_Counter
                      00500         ;disable capacitor charger, GPIO1
010F   1283           00501         Banksel GPIO
0110   1085           00502         bcf             GPIO,1
0111   3014           00503         movlw   .020                            ;; needs testing if it can be reduced to 20ms
0112   2???           00504         call    DelayMs                         ; Call DelayMs Subroutine
                      00505 
                      00506 
                      00507         ;set Status to Off 001
0113   1283           00508         Banksel Status1
0114   1427           00509         BSF Status1,0
0115   10A7           00510         BCF Status1,1
0116   1127           00511         BCF Status1,2
                      00512 
                      00513 
                      00514 
                      00515         ;Pull data Low
0117   1283           00516         Banksel GPIO
0118   1005           00517         BCF     GPIO,0  ;       debug
                      00518 
                      00519         ;set GPIO4 high for 1ms
0119   1283           00520         Banksel GPIO
011A   1685           00521         bsf             GPIO,5
011B   3005           00522         movlw   .005                            ; 1 ms delay
011C   2???           00523         call    DelayMs                         ; Call DelayMs Subroutine
011D   1283           00524         Banksel GPIO
011E   1285           00525         bcf             GPIO,5
                      00526 
                      00527 
                      00528         ;wait till switch cycle is complete
011F   3064           00529         movlw   .100                            ; needs testing if it can be reduced to 20ms
0120   2???           00530         call    DelayMs                         ; Call DelayMs Subroutine
                      00531 
0121   0064           00532         CLRWDT                                          ;just in case
                      00533         ;turn capacitor charger back on
0122   1283           00534         Banksel GPIO
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0123   1485           00535         bsf             GPIO,1
                      00536 
0124   2???           00537         call Blink_LED
0125   3064           00538         movlw   .100                                    ;Wait 100 ms delay,
0126   2???           00539         call    DelayMs
0127   2???           00540         call Blink_LED
0128   3064           00541         movlw   .100                                    ;Wait 100 ms delay,
0129   2???           00542         call    DelayMs
012A   2???           00543         call Blink_LED
012B   3064           00544         movlw   .100                                    ;Wait 100 ms delay,
012C   0064           00545         CLRWDT                                  ;clear the WDT just in case
                      00546 
012D   2???           00547         call    DelayMs
012E   2???           00548         call Blink_LED
012F   3064           00549         movlw   .100                                    ;Wait 100 ms delay,
0130   2???           00550         call    DelayMs
0131   2???           00551         call Blink_LED
0132   3064           00552         movlw   .100                                    ;Wait 100 ms delay,
0133   2???           00553         call    DelayMs
0134   2???           00554         call Blink_LED
                      00555 
0135   1283           00556         Banksel TMR0
0136   0181           00557         Clrf    TMR0                                    ;reset the time0
                      00558 
0137   2???           00559         goto Return_From_Interrupt
                      00560 
Warning[207]: Found label after column 1. (Return_From_Interrupt)
0138                  00561         Return_From_Interrupt
0138   0064           00562         CLRWDT
0139   1283           00563         Banksel INTCON
013A   108B           00564         BCF INTCON,INTF                                 ;clear gp2 interrupt
013B   110B           00565         BCF INTCON,T0IF                                 ;reset time interrupt bit
013C   100B           00566         BCF INTCON,GPIF                                 ;cleare gpio interrupt flag
013D   178B           00567         BSF INTCON,GIE                                  ;enable all interups
013E   110B           00568         BCF     INTCON,T0IF                             ;clear timer interrupt
013F   160B           00569         BSF     INTCON,INTE
                      00570 
                      00571 
0140   0009           00572         retfie                                                  ;return from interrupt
                      00573 
                      00574 
                      00575 
0141                  00576 PWM_warning
0141   301E           00577         movlw   .030
0142   00A9           00578         movwf   PWM_timout_counter_rollover
0143   2???           00579         call Blink_LED
0144   0008           00580         return
                      00581 
                      00582 
                      00583 
                      00584 
                      00585 
                      00586 
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00587 
                      00588 
0145                  00589 Blink_LED:
                      00590                                                 ;Set GPIO 2 output
Warning[205]: Found directive in column 1. (Banksel)
0145   1683           00591 Banksel TRISIO
Warning[203]: Found opcode in column 1. (BCF)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0146   1105           00592 BCF             TRISIO,2                ; GPIO,2 output
                      00593 ;lblink the led
Warning[205]: Found directive in column 1. (Banksel)
0147   1283           00594 Banksel GPIO
Warning[203]: Found opcode in column 1. (bsf)
0148   1505           00595 bsf             GPIO,2                  ; Set GP2 Output To High
Warning[203]: Found opcode in column 1. (movlw)
0149   300A           00596 movlw   .010                                    ;Wait 10 ms delay, just in case there the PWM is noisy
Warning[203]: Found opcode in column 1. (call)
014A   2???           00597 call    DelayMs
                      00598 
Warning[205]: Found directive in column 1. (Banksel)
014B   1283           00599 Banksel GPIO
Warning[203]: Found opcode in column 1. (bcf)
014C   1105           00600 bcf             GPIO,2                  ; Set GP2 Output To High
Warning[205]: Found directive in column 1. (Banksel)
014D   1683           00601 Banksel TRISIO
Warning[203]: Found opcode in column 1. (BSF)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
014E   1505           00602 BSF             TRISIO,2                ; GPIO,2 input
Warning[203]: Found opcode in column 1. (movlw)
014F   300A           00603 movlw   .010                                    ;Wait 10 ms delay, just in case there the PWM is noisy
Warning[203]: Found opcode in column 1. (call)
0150   2???           00604 call    DelayMs
Warning[203]: Found opcode in column 1. (return)
0151   0008           00605 return                                  ; return to the caller
                      00606 
                      00607 
                      00608 
                      00609 
                      00610 
                      00611 
                      00612         ;----------------- DelayMs: Milisecond Delay Subroutine ----------------------
                      00613 ; Paramater: WREG = delay amount in milisecond, max: 255 milisecond
0152                  00614 DelayMs:
0152   00A1           00615      movwf  Delay + 1
0153                  00616 DelayLoop:
0153   2???           00617      call   Delay1ms
0154   0BA1           00618      decfsz Delay + 1,f   ; Decrease Delay + 1, If zero skip the next instruction
0155   2???           00619      goto   DelayLoop     ; Not zero goto DelayLoop
0156   0008           00620      return               ; return to the caller
                      00621 
                      00622 ;----------------- Delay1ms: 1 ms Delay Subroutine ---------------------------
0157                  00623 Delay1ms:                 ; Total Delay: 1998 x 0.5us ~ 1 ms
0157   3099           00624      movlw  0x99
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0158   00A0           00625      movwf  Delay
0159                  00626 DelayLoop1:
0159   0BA0           00627      decfsz Delay,f       ; Decrease Delay, If zero skip the next instruction
015A   2???           00628      goto   DelayLoop1
015B                  00629 DelayLoop2:
015B   0BA0           00630      decfsz Delay,f       ; Decrease Delay1, If zero skip the next instruction
015C   2???           00631      goto   DelayLoop2    ; Not zero goto DelayLoop2
015D                  00632 DelayLoop3:
015D   0BA0           00633      decfsz Delay,f       ; Decrease Delay1, If zero skip the next instruction
015E   2???           00634      goto   DelayLoop3    ; Not zero goto DelayLoop2
015F   0008           00635      return               ; Return to the caller
                      00636 
33DC                  00637      end
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ANS0                              00000000
ANS1                              00000001
ANS2                              00000002
ANS3                              00000003
ANSEL                             0000009F
Blink_LED                         00000145
Button                            0000006E
C                                 00000000
CCP1CON                           00000015
CCP1IE                            00000005
CCP1IF                            00000005
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCPR1                             00000013
CCPR1H                            00000014
CCPR1L                            00000013
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CINV                              00000004
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            00000019
CMCON1                            0000001A
CMIE                              00000003
CMIF                              00000003
CMSYNC                            00000000
COUT                              00000006
Center_Pulse_Lengh                00000024
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
Delay                             00000020
Delay1ms                          00000157
DelayLoop                         00000153
DelayLoop1                        00000159
DelayLoop2                        0000015B
DelayLoop3                        0000015D
DelayMs                           00000152
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDAT                             0000009A
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
F                                 00000001
FSR                               00000004
Falling_Edge                      0000007F
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
GP0                               00000000
GP1                               00000001
GP2                               00000002
GP3                               00000003
GP4                               00000004
GP5                               00000005
GPIE                              00000003
GPIF                              00000000
GPIO                              00000005
GPIO_Current                      00000026
GPIO_Last                         00000025
HTS                               00000002
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOC                               00000096
IOC0                              00000000
IOC1                              00000001
IOC2                              00000002
IOC3                              00000003
IOC4                              00000004
IOC5                              00000005
IOCA                              00000096
IOCA0                             00000000
IOCA1                             00000001
IOCA2                             00000002
IOCA3                             00000003
IOCA4                             00000004
IOCA5                             00000005
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
Interrupt_Call                    00000057
Invalid_PWM                       000000B6
LTS                               00000001
Main_Loop                         00000055
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

NOT_BOD                           00000000
NOT_DONE                          00000001
NOT_GPPU                          00000007
NOT_PD                            00000003
NOT_POR                           00000001
NOT_T1SYNC                        00000002
NOT_TO                            00000004
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000002
OSFIF                             00000002
OSTS                              00000003
Off_Pulse                         0000009F
Off_Pulse_Lengh                   00000022
On_Pulse                          0000009A
On_Pulse_Lengh                    00000023
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PWM                               00000077
PWM_Counter                       0000002A
PWM_Last                          0000002B
PWM_Lengh                         00000028
PWM_current                       0000002C
PWM_timout_counter_rollover       00000029
PWM_warning                       00000141
RD                                00000000
RP0                               00000005
RP1                               00000006
Reset_PWM_Counter_Off             000000A9
Reset_PWM_Counter_On              000000A4
Return_From_Interrupt             00000138
Rising_Edge                       0000007C
SBODEN                            00000004
SCS                               00000000
STATUS                            00000003
SWDTEN                            00000000
Setup                             00000005
Start                             00000000
Status1                           00000027
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GE                              00000006
T1GINV                            00000007
T1GSS                             00000001
T1IE                              00000000
T1IF                              00000000
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
T2IE                              00000001
T2IF                              00000001
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISIO                            00000085
TRISIO0                           00000000
TRISIO1                           00000001
TRISIO2                           00000002
TRISIO3                           00000003
TRISIO4                           00000004
TRISIO5                           00000005
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
Timer                             00000068
Turn_Off                          0000010D
Turn_On                           000000B9
ULPWUE                            00000005
VCFG                              00000006
VR0                               00000000
VR1                               00000001
VR2                               00000002
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

VR3                               00000003
VRCON                             00000099
VREN                              00000007
VRR                               00000005
W                                 00000000
WDTCON                            00000018
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU4                              00000004
WPU5                              00000005
WPUA                              00000095
WPUA0                             00000000
WPUA1                             00000001
WPUA2                             00000002
WPUA4                             00000004
WPUA5                             00000005
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
MPASM 5.57               EPM_V2_12_SOURC.ASM   2-6-2015  14:16:07         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_XT_OSC                           00003FF9
__12F683                          00000001
blah                              0000006B
debug                             000000B1
normo                             00000083
test                              000000AE

Errors   :     0
Warnings :    17 reported,     0 suppressed
Messages :    27 reported,     0 suppressed

